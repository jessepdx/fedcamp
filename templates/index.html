{% extends "base.html" %}
{% block title %}Federal Camping Finder — Search{% endblock %}

{% block content %}
<hgroup>
    <h1>Advanced Search</h1>
    <p>Find campgrounds with detailed filters</p>
</hgroup>

<form action="/search" method="get">
    <article>
        <header><strong>Location</strong></header>

        <div class="search-mode-toggle">
            <label>
                <input type="radio" name="search_mode" value="state" checked
                       onchange="document.getElementById('state-fields').style.display='';
                                 document.getElementById('latlon-fields').style.display='none';">
                Search by State
            </label>
            <label>
                <input type="radio" name="search_mode" value="latlon"
                       onchange="document.getElementById('state-fields').style.display='none';
                                 document.getElementById('latlon-fields').style.display='';">
                Search Nearby
            </label>
        </div>

        <div id="state-fields">
            <label for="state-select">Hold Ctrl / Cmd to select multiple states</label>
            <select name="state" id="state-select" aria-label="State" multiple size="8">
                {% for s in states %}
                <option value="{{ s.state_code }}">{{ s.state_code }} ({{ s.facility_count }} campgrounds)</option>
                {% endfor %}
            </select>
        </div>

        <div id="latlon-fields" style="display:none">
            <input type="hidden" name="lat" id="geo-lat">
            <input type="hidden" name="lon" id="geo-lon">
            <div class="geo-locate-row">
                <button type="button" id="geo-btn" class="outline" onclick="geoLocate()">
                    Use My Location
                </button>
                <span id="geo-status" class="geo-status"></span>
            </div>
            <label>
                Radius (miles)
                <select name="radius">
                    <option value="25">25 miles</option>
                    <option value="50">50 miles</option>
                    <option value="100" selected>100 miles</option>
                    <option value="200">200 miles</option>
                </select>
            </label>
        </div>
    </article>

    <article>
        <header><strong>Camping Type</strong></header>
        <fieldset>
            {% for val, label in camping_types %}
            <label>
                <input type="checkbox" name="camping_type" value="{{ val }}"
                       {{ 'checked' if val == 'DEVELOPED' else '' }}>
                {{ label }}
            </label>
            {% endfor %}
        </fieldset>
    </article>

    <article>
        <header><strong>Conditions</strong> <small>(leave unchecked for all)</small></header>
        <div class="grid">
            <div>
                <label><strong>Road Access</strong></label>
                {% for val, label in road_access_options %}
                <label>
                    <input type="checkbox" name="road_access" value="{{ val }}">
                    {{ label }}
                </label>
                {% endfor %}
            </div>
            <div>
                <label><strong>Season</strong></label>
                {% for val, label in seasonal_options %}
                <label>
                    <input type="checkbox" name="seasonal_status" value="{{ val }}">
                    {{ label }}
                </label>
                {% endfor %}
            </div>
            <div>
                <label><strong>Campfires</strong></label>
                {% for val, label in fire_options %}
                <label>
                    <input type="checkbox" name="fire_status" value="{{ val }}">
                    {{ label }}
                </label>
                {% endfor %}
            </div>
        </div>
    </article>

    <article>
        <header><strong>RV Length</strong> <small>(feet, optional)</small></header>
        <input type="number" name="rv_length" min="10" max="150" placeholder="e.g. 35">
    </article>

    <article>
        <header><strong>Agency</strong> <small>(leave unchecked for all)</small></header>
        <div class="tag-grid">
            {% for val, label in agencies %}
            <label>
                <input type="checkbox" name="agency" value="{{ val }}">
                {{ val }} — {{ label }}
            </label>
            {% endfor %}
        </div>
    </article>

    <article>
        <header><strong>Amenities</strong></header>
        <div class="tag-grid">
            {% for val, label in amenity_filters %}
            <label>
                <input type="checkbox" name="tag" value="{{ val }}">
                {{ label }}
            </label>
            {% endfor %}
        </div>
    </article>

    <button type="submit" onclick="return validateSearch()">Search Campgrounds</button>
</form>
{% endblock %}
